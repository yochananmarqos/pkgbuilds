# https://aur.archlinux.org/packages/fresh-editor-bin

pkgname=fresh-editor-bin
_app_id=io.github.sinelaw.fresh
pkgver=0.2.4
pkgrel=1
pkgdesc="A lightweight, fast terminal-based text editor with LSP support and TypeScript plugins"
url="https://getfresh.dev"
license=('GPL-2.0-or-later')
arch=('x86_64' 'aarch64')
depends=(
  'bash'
  'glibc'
  'hicolor-icon-theme'
  'libgcc'
)
provides=("${pkgname%-bin}")
conflicts=("${pkgname%-bin}")
source=("${_app_id}-$pkgver.desktop::https://raw.githubusercontent.com/sinelaw/fresh/refs/tags/v$pkgver/crates/${pkgname%-bin}/flatpak/${_app_id}.desktop"
        "${_app_id}-$pkgver.metainfo.xml::https://raw.githubusercontent.com/sinelaw/fresh/refs/tags/v$pkgver/crates/${pkgname%-bin}/flatpak/${_app_id}.metainfo.xml"
        "${_app_id}-$pkgver.svg::https://raw.githubusercontent.com/sinelaw/fresh/refs/tags/v$pkgver/crates/${pkgname%-bin}/flatpak/${_app_id}.svg"
        "default-$pkgver.json::https://raw.githubusercontent.com/sinelaw/fresh/refs/tags/v$pkgver/crates/${pkgname%-bin}/keymaps/default.json"
        "emacs-$pkgver.json::https://raw.githubusercontent.com/sinelaw/fresh/refs/tags/v$pkgver/crates/${pkgname%-bin}/keymaps/default.json"
        "macos-$pkgver.json::https://raw.githubusercontent.com/sinelaw/fresh/refs/tags/v$pkgver/crates/${pkgname%-bin}/keymaps/default.json"
        "vscode-$pkgver.json::https://raw.githubusercontent.com/sinelaw/fresh/refs/tags/v$pkgver/crates/${pkgname%-bin}/keymaps/default.json")
source_x86_64=("fresh-editor-0.2.3-x86_64.tar.xz::https://github.com/sinelaw/fresh/releases/download/v$pkgver/${pkgname%-bin}-x86_64-unknown-linux-gnu.tar.xz")
source_aarch64=("fresh-editor-0.2.3-aarch64.tar.xz::https://github.com/sinelaw/fresh/releases/download/v$pkgver/${pkgname%-bin}-aarch64-unknown-linux-gnu.tar.xz")
sha256sums=('4acf3ec46f32671bea0a285b095f66f6e55dcb44b2214ec53cc4bb47ccccf687'
            '9b0ca813b9be3316f08e8b4233e3f081a06be2eb62999335787e1fdf33976e7d'
            '9b6f6dd3a15657890738c69d7891ffbf23de4b55e4d7cf89ccedb54604a9a770'
            '7a512e934aa29d97466000c390a3bbfbb79d377c13f1db4eb6a04fed2659ebc4'
            '7a512e934aa29d97466000c390a3bbfbb79d377c13f1db4eb6a04fed2659ebc4'
            '7a512e934aa29d97466000c390a3bbfbb79d377c13f1db4eb6a04fed2659ebc4'
            '7a512e934aa29d97466000c390a3bbfbb79d377c13f1db4eb6a04fed2659ebc4')
sha256sums_x86_64=('bae4c0dcf3b2bca05abac30df229af8037798aa8169f60d17771c9676cd97df0')
sha256sums_aarch64=('bd55436cf814564cca0345f9a0026b6a8090692990f3eb2aaa9399dc919e98d4')

package() {
  cd "${pkgname%-bin}-${CARCH}-unknown-linux-gnu"
  install -Dm755 fresh "$pkgdir/usr/share/${pkgname%-bin}/fresh"
  cp -r plugins themes "$pkgdir/usr/share/fresh-editor/"

  install -d "$pkgdir/usr/bin"
  ln -s "/usr/share/${pkgname%-bin}/fresh" "$pkgdir/usr/bin/fresh"

  install -Dm644 README.md -t "$pkgdir/usr/share/doc/$pkgname/"
  install -Dm644 "$srcdir/${_app_id}-$pkgver.desktop" \
    "$pkgdir/usr/share/applications/${_app_id}.desktop"
  install -Dm644 "$srcdir/${_app_id}-$pkgver.metainfo.xml" \
    "$pkgdir/usr/share/metainfo/${_app_id}.metainfo.xml"
  install -Dm644 "$srcdir/${_app_id}-$pkgver.svg" \
    "$pkgdir/usr/share/icons/hicolor/scalable/apps/${_app_id}.svg"
  install -Dm644 "$srcdir"/*.json -t "$pkgdir/usr/share/fresh-editor/keymaps/"
}
